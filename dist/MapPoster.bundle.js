!function(){var e={669:function(){window.L.Map.mergeOptions({smoothWheelZoom:!0,smoothSensitivity:1}),window.L.Map.SmoothWheelZoom=window.L.Handler.extend({addHooks:function(){window.L.DomEvent.on(this._map._container,"wheel",this._onWheelScroll,this)},removeHooks:function(){window.L.DomEvent.off(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){this._isWheeling||this._onWheelStart(e),this._onWheeling(e)},_onWheelStart:function(e){var t=this._map;this._isWheeling=!0,this._wheelMousePosition=t.mouseEventToContainerPoint(e),this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),this._wheelStartLatLng=t.containerPointToLatLng(this._wheelMousePosition),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),t._panAnim&&t._panAnim.stop(),this._goalZoom=t.getZoom(),this._prevCenter=t.getCenter(),this._prevZoom=t.getZoom(),this._zoomAnimationId=requestAnimationFrame(this._updateWheelZoom.bind(this))},_onWheeling:function(e){var t=this._map;this._goalZoom=this._goalZoom+.003*window.L.DomEvent.getWheelDelta(e)*t.options.smoothSensitivity,(this._goalZoom<t.getMinZoom()||this._goalZoom>t.getMaxZoom())&&(this._goalZoom=t._limitZoom(this._goalZoom)),this._wheelMousePosition=this._map.mouseEventToContainerPoint(e),clearTimeout(this._timeoutId),this._timeoutId=setTimeout(this._onWheelEnd.bind(this),200),window.L.DomEvent.preventDefault(e),window.L.DomEvent.stopPropagation(e)},_onWheelEnd:function(){this._isWheeling=!1,cancelAnimationFrame(this._zoomAnimationId),this._map._moveEnd(!0)},_updateWheelZoom:function(){var e=this._map;if(e.getCenter().equals(this._prevCenter)&&e.getZoom()==this._prevZoom){this._zoom=e.getZoom()+.3*(this._goalZoom-e.getZoom()),this._zoom=Math.floor(100*this._zoom)/100;var t=this._wheelMousePosition.subtract(this._centerPoint);0===t.x&&0===t.y||("center"===e.options.smoothWheelZoom?this._center=this._startLatLng:this._center=e.unproject(e.project(this._wheelStartLatLng,this._zoom).subtract(t),this._zoom),this._moved||(e._moveStart(!0,!1),this._moved=!0),e._move(this._center,this._zoom),this._prevCenter=e.getCenter(),this._prevZoom=e.getZoom(),this._zoomAnimationId=requestAnimationFrame(this._updateWheelZoom.bind(this)))}}}),window.L.Map.addInitHook("addHandler","smoothWheelZoom",window.L.Map.SmoothWheelZoom)}},t={};function o(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n={};!function(){"use strict";o.d(n,{default:function(){return d}}),o(669);var e={attribution:'Map tiles by <a href="https://carto.com/attributions">Carto</a> under <a href="http://www.openstreetmap.org/copyright">ODbL</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",maxZoom:20},t={attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a> under <a href="http://www.openstreetmap.org/copyright">ODbL</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:1,maxZoom:16},a={attribution:'Map tiles by <a href="http://mapiful.com">Mapiful</a> under <a href="http://www.openstreetmap.org/copyright">ODbL</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',minZoom:1,maxZoom:21},i={layers:{OpenStreetMap:window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:1,maxZoom:19}),"Imagery (E)":window.L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'Map tiles by <a href="https://www.esri.com/">Esri</a> &mdash; Map data &copy; Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',minZoom:1,maxZoom:18}),"Voyager (C)":window.L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png",e),"Positron (C)":window.L.tileLayer("https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png",e),"Dark Matter (C)":window.L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png",e),"OldSchool (M)":window.L.tileLayer("https://tiles.mapiful.com/oldschool/{z}/{x}/{y}.png",a),"Nara (M)":window.L.tileLayer("https://tiles.mapiful.com/nara/{z}/{x}/{y}.png",a),"Playroom (M)":window.L.tileLayer("https://tiles.mapiful.com/playroom/{z}/{x}/{y}.png",a),"Orange (M)":window.L.tileLayer("https://tiles.mapiful.com/mother/{z}/{x}/{y}.png",a),"Mono (M)":window.L.tileLayer("https://tiles.mapiful.com/mono/{z}/{x}/{y}.png",a),"Mono Inverted (M)":window.L.tileLayer("https://tiles.mapiful.com/inverted/{z}/{x}/{y}.png",a),"Gold (M)":window.L.tileLayer("https://tiles.mapiful.com/gold/{z}/{x}/{y}.png",a),"Asphalt (M)":window.L.tileLayer("https://tiles.mapiful.com/asphalt/{z}/{x}/{y}.png",a),"Lagoon (M)":window.L.tileLayer("https://tiles.mapiful.com/lagoon/{z}/{x}/{y}.png",a),"Blue (M)":window.L.tileLayer("https://tiles.mapiful.com/blue/{z}/{x}/{y}.png",a),"Sky (M)":window.L.tileLayer("https://tiles.mapiful.com/sky/{z}/{x}/{y}.png",a),"Spring (M)":window.L.tileLayer("https://tiles.mapiful.com/spring/{z}/{x}/{y}.png",a),"Red (M)":window.L.tileLayer("https://tiles.mapiful.com/red/{z}/{x}/{y}.png",a),"Gaia (M)":window.L.tileLayer("https://tiles.mapiful.com/gaia/{z}/{x}/{y}.png",a),"Coral (M)":window.L.tileLayer("https://tiles.mapiful.com/coral/{z}/{x}/{y}.png",a),"Pink (M)":window.L.tileLayer("https://tiles.mapiful.com/valentine/{z}/{x}/{y}.png",a),"Purple (M)":window.L.tileLayer("https://tiles.mapiful.com/lavender/{z}/{x}/{y}.png",a),"Toner (S)":window.L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}{r}.png",t),"Watercolor (S)":window.L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png",t)},overlays:{"Toner Lines (S)":window.L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lines/{z}/{x}/{y}{r}.png",t)}};function r(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=window.jspdf.jsPDF,s=!1,d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=null,this._search=null,this._tilesLoaded=!1,this._commentEdited=!1,this._intervalId=-1,this._cssTheme={},this._initInterface().then(this._initEvents.bind(this)).catch((function(e){return console.error(e)}))}var t,o;return t=e,(o=[{key:"_initInterface",value:function(){var e=this;return new Promise((function(t,o){try{e._map=window.L.map("map",{attributionControl:!1,zoomSnap:0,scrollWheelZoom:!1,smoothWheelZoom:!0,smoothSensitivity:1}).setView([44.79777779831652,1.542703666063447],5),e._search=new window.L.Control.Search({url:"https://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],marker:!1,autoCollapse:!0,firstTipSubmit:!0,textPlaceholder:"Rechercher...",textCancel:"Annuler",textErr:"Aucun résultat..."})}catch(e){return void o(e)}i.layers["Imagery (E)"].addTo(e._map),document.getElementById("map-attribution").innerHTML=i.layers["Imagery (E)"].getAttribution(),window.L.control.layers(i.layers,i.overlays,{position:"topright"}).addTo(e._map),e._map.addControl(e._search),e._applyTexts();var n=localStorage.getItem("theme");n&&JSON.parse(n)&&(e._cssTheme=JSON.parse(n),e.applyThemeColor()),t()}))}},{key:"_initEvents",value:function(){var e=this;return new Promise((function(t){for(var o=document.getElementById("map-orientation"),n=0;n<o.children.length;++n)o.children[n].addEventListener("click",e._updateMapOrientation.bind(e));for(var a=document.getElementById("map-style"),r=0;r<a.children.length;++r)a.children[r].addEventListener("click",e._updateMapStyle.bind(e));for(var l in document.getElementById("dark-theme").addEventListener("change",e._updateDarkTheme.bind(e)),document.getElementById("txt-position").addEventListener("change",e._updateTextPosition.bind(e)),document.getElementById("theme-editor").addEventListener("click",e._themeEditModal.bind(e)),document.getElementById("title-color").addEventListener("input",e._textColorEdit.bind(e)),document.getElementById("subtitle-color").addEventListener("input",e._textColorEdit.bind(e)),document.getElementById("comment-color").addEventListener("input",e._textColorEdit.bind(e)),document.getElementById("modal-overlay").addEventListener("click",e._closeModal.bind(e)),document.getElementById("user-title").addEventListener("input",e._applyTexts.bind(e)),document.getElementById("user-subtitle").addEventListener("input",e._applyTexts.bind(e)),document.getElementById("user-comment").addEventListener("input",e._applyTexts.bind(e)),document.getElementById("image-width").addEventListener("input",e._updateDimensionLabel.bind(e)),document.getElementById("map-save").addEventListener("click",e._download.bind(e)),document.getElementById("credit-modal").addEventListener("click",e._creditModal.bind(e)),i.layers)i.layers[l].on("load",(function(){return setTimeout((function(){return e._tilesLoaded=!0}),2e3)})),i.layers[l].on("add",(function(e){document.getElementById("map-attribution").innerHTML=e.target.getAttribution()}));e._map.on("move",e._updateCommentLabel.bind(e)),e._search.on("search:locationfound",e._searchMatch.bind(e)),t()}))}},{key:"_updateMapOrientation",value:function(e){for(var t=this,o="",n=document.getElementById("map-orientation"),a=0;a<n.children.length;++a)if(n.children[a].classList.contains("selected")){o=n.children[a].dataset.orientation,n.children[a].classList.remove("selected");break}e.target.classList.add("selected"),document.getElementById("map-output").classList.remove("".concat(o)),document.getElementById("map-output").classList.add("".concat(e.target.dataset.orientation)),setTimeout((function(){var e=t._map.getBounds();t._map.invalidateSize(),t._map.fitBounds(e)}),200)}},{key:"_updateDarkTheme",value:function(e){e.target.checked?(document.body.classList.remove("light-theme"),document.body.classList.add("dark-theme")):(document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme"))}},{key:"_updateTextPosition",value:function(e){e.target.checked?document.getElementById("map-output").classList.add("txt-reverse"):document.getElementById("map-output").classList.remove("txt-reverse")}},{key:"_updateMapStyle",value:function(e){for(var t="",o=document.getElementById("map-style"),n=0;n<o.children.length;++n)if(o.children[n].classList.contains("selected")){t=o.children[n].dataset.style,o.children[n].classList.remove("selected");break}e.target.classList.add("selected"),document.getElementById("map-output").classList.remove("".concat(t,"-style")),document.getElementById("map-output").classList.add("".concat(e.target.dataset.style,"-style"))}},{key:"_applyTexts",value:function(e){document.getElementById("title").innerHTML=document.getElementById("user-title").value,document.getElementById("subtitle").innerHTML=document.getElementById("user-subtitle").value,document.getElementById("comment").innerHTML=document.getElementById("user-comment").value,e&&e.target&&"user-comment"===e.target.id&&(this._commentEdited=!0)}},{key:"_textColorEdit",value:function(e){document.getElementById(e.target.dataset.type).style.color=e.target.value}},{key:"_updateCommentLabel",value:function(){if(!this._commentEdited){var e=this._map.getCenter();document.getElementById("comment").innerHTML="".concat(this.precisionRound(e.lat,3),"°N / ").concat(this.precisionRound(e.lng,3),"° E")}}},{key:"_updateDimensionLabel",value:function(e){var t=e.target.previousElementSibling,o="7";e.target.value>4961?o="2":e.target.value>3508?o="3":e.target.value>2480?o="4":e.target.value>1754?o="5":e.target.value>1241&&(o="6");var n=this.precisionRound(29.7*e.target.value/21,0);e.target.dataset.height=n,document.getElementById("map-output").classList.contains("horizontal")?t.innerHTML="Dimension : ".concat(n," x ").concat(e.target.value," — A").concat(o," à 300dpi"):t.innerHTML="Dimension : ".concat(e.target.value," x ").concat(n," — A").concat(o," à 300dpi")}},{key:"_searchMatch",value:function(e){this._map.setView(e.latlng)}},{key:"_download",value:function(){var e=this;document.getElementById("print-overlay").style.zIndex=99,document.getElementById("print-overlay").style.opacity=1,document.getElementById("map-output").style.transition="none",setTimeout((function(){var t=document.getElementById("image-width").value,o=t/600;if(document.getElementById("map-output").classList.contains("horizontal")){var n=document.getElementById("image-width").dataset.height;o=n/600,t=n}var a=e._map.getBounds();e._dlPrepareMap(t,o,a),1===o&&(e._tilesLoaded=!0),e._intervalId=setInterval(e._dlPerformMapPrint.bind(e,a),1e3)}),200)}},{key:"_dlPrepareMap",value:function(e,t,o){var n=this;document.getElementById("print-status").innerHTML="Préparation du style de la carte pour l'export...",document.getElementById("print-progress").style.width="10%",document.querySelector(".leaflet-top.leaflet-left").style.display="none",document.querySelector(".leaflet-top.leaflet-right").style.display="none";var a=parseInt(window.getComputedStyle(document.getElementById("map-output")).getPropertyValue("--padding").replace("rem","")),i=parseInt(window.getComputedStyle(document.getElementById("map-output")).getPropertyValue("--thick-border").replace("px","")),r=parseInt(window.getComputedStyle(document.getElementById("map-output")).getPropertyValue("--small-border").replace("px",""));document.getElementById("map-output").style.setProperty("--padding","".concat(a*t,"rem")),document.getElementById("map-output").style.setProperty("--thick-border","".concat(i*t,"px")),document.getElementById("map-output").style.setProperty("--small-border","".concat(r*t,"px")),document.body.style.fontSize="".concat(1.2*t,"rem"),this._tilesLoaded=!1,document.getElementById("map-output").classList.contains("horizontal")?document.getElementById("map-output").style.height="".concat(e,"px"):document.getElementById("map-output").style.width="".concat(e,"px"),document.body.clientWidth<1150&&(document.querySelector(".user-text-wrapper").style.fontSize="inherit"),document.getElementById("map-output").style.position="absolute",document.getElementById("map-output").classList.remove("shadow"),document.getElementById("map-output").style.boxShadow="none",requestAnimationFrame((function(){n._map.invalidateSize(),n._map.fitBounds(o),document.getElementById("print-status").innerHTML="En attente du chargement des tuiles de la carte...",document.getElementById("print-progress").style.width="25%"}))}},{key:"_dlPerformMapPrint",value:function(e){var t=this;!0===this._tilesLoaded&&(document.getElementById("print-status").innerHTML="Tuiles chargées, démarrage de l'export...",document.getElementById("print-progress").style.width="66%",clearInterval(this._intervalId),this._tilesLoaded=!1,requestAnimationFrame((function(){window.html2canvas(document.getElementById("map-output"),{logging:s,useCORS:!0,allowTaint:!0,width:document.getElementById("map-output").offsetWidth,height:document.getElementById("map-output").offsetHeight,imageTimeout:0,onclone:function(){document.getElementById("print-status").innerHTML="Création du fichier de sortie...",document.getElementById("print-progress").style.width="72%"}}).then(t._dlMap.bind(t,e)).catch((function(o){console.error(o),t._dlRestoreMap(e)}))})))}},{key:"_dlMap",value:function(e,t){document.getElementById("print-status").innerHTML="Export terminé. Sauvegarde sur le disque en cours...",document.getElementById("print-progress").style.width="88%";var o=this.getOutputFileType(),n=document.createElement("A");if(n.download="".concat(document.getElementById("title").innerHTML,".").concat(o.extension),"pdf"===o.type){var a=document.getElementById("image-width-label").innerHTML.split("—")[1].replace(" ","").substring(0,2),i=new l({orientation:document.getElementById("map-output").classList.contains("horizontal")?"landscape":"portrait",format:a,precision:32}),r=i.internal.pageSize.getWidth(),s=i.internal.pageSize.getHeight();i.addImage(t.toDataURL("image/png",1),"PNG",0,0,r,s),i.save("".concat(document.getElementById("title").innerHTML,".pdf"))}else n.href=t.toDataURL("image/".concat(o.type),1),n.click();this._dlRestoreMap(e)}},{key:"_dlRestoreMap",value:function(e){var t=this;document.getElementById("print-status").innerHTML="Remise en état du style initial...",document.getElementById("print-progress").style.width="100%",document.querySelector(".leaflet-top.leaflet-left").style.display="inherit",document.querySelector(".leaflet-top.leaflet-right").style.display="inherit",document.body.style.fontSize="1.2rem",document.body.clientWidth<1150&&(document.querySelector(".user-text-wrapper").style.fontSize="50%"),document.getElementById("map-output").style="",document.getElementById("map-output").classList.add("shadow"),document.getElementById("print-overlay").style.opacity=0,setTimeout((function(){document.getElementById("print-overlay").style.zIndex=-1,t._map.invalidateSize(),t._map.fitBounds(e),document.getElementById("map-output").style.transition="all .2s"}),200)}},{key:"_themeEditModal",value:function(e){var t=this;e.preventDefault(),this._fetchModal("themeedit").then((function(e){var o=function(){document.getElementById("light-bg-color").value=t._cssTheme.lbg,document.getElementById("light-txt-color").value=t._cssTheme.ltxt,document.getElementById("light-txt-alt-color").value=t._cssTheme.lcom,document.getElementById("dark-bg-color").value=t._cssTheme.dbg,document.getElementById("dark-txt-color").value=t._cssTheme.dtxt,document.getElementById("dark-txt-alt-color").value=t._cssTheme.dcom},n=function(e){document.querySelector(":root").style.setProperty("--color-".concat(e.target.dataset.key),e.target.value),t.updateThemeColorInternal()};e.querySelector("#light-bg-color").addEventListener("input",n),e.querySelector("#light-txt-color").addEventListener("input",n),e.querySelector("#light-txt-alt-color").addEventListener("input",n),e.querySelector("#dark-bg-color").addEventListener("input",n),e.querySelector("#dark-txt-color").addEventListener("input",n),e.querySelector("#dark-txt-alt-color").addEventListener("input",n),t.updateThemeColorInternal(),e.querySelector("#close").addEventListener("click",t._closeModal.bind(t,null,!0)),e.querySelector("#reset").addEventListener("click",(function(){t._cssTheme.lbg="#FFFFFE",t._cssTheme.ltxt="#000001",t._cssTheme.lcom="#999998",t._cssTheme.dbg="#000001",t._cssTheme.dtxt="#FFFFFE",t._cssTheme.dcom="#999998",t.applyThemeColor(),o()})),document.getElementById("modal-overlay").appendChild(e),document.getElementById("modal-overlay").style.display="flex",setTimeout((function(){return document.getElementById("modal-overlay").style.opacity=1}),50),requestAnimationFrame(o.bind(t))}))}},{key:"_creditModal",value:function(e){var t=this;e.preventDefault(),this._fetchModal("credits").then((function(e){e.querySelector("#confirm").addEventListener("click",t._closeModal.bind(t,null,!0)),document.getElementById("modal-overlay").appendChild(e),document.getElementById("modal-overlay").style.display="flex",setTimeout((function(){return document.getElementById("modal-overlay").style.opacity=1}),50)}))}},{key:"_fetchModal",value:function(e){return new Promise((function(t){fetch("assets/html/".concat(e,".html")).then((function(e){e.text().then((function(e){t(document.createRange().createContextualFragment(e))}))}))}))}},{key:"_closeModal",value:function(e,t){!0!==t&&"modal-overlay"!==e.target.id&&-1===e.target.id.indexOf("close")||(document.getElementById("modal-overlay").style.opacity=0,setTimeout((function(){document.getElementById("modal-overlay").style.display="none",document.getElementById("modal-overlay").innerHTML=""}),300))}},{key:"getOutputFileType",value:function(){var e={extension:"png",type:"png"};return Array.from(document.getElementById("image-type").elements).forEach((function(t){!0===t.checked&&(e.extension=t.dataset.extension,e.type=t.dataset.type)})),e}},{key:"precisionRound",value:function(e,t){var o=Math.pow(10,t||0);return Math.round(e*o)/o}},{key:"updateThemeColorInternal",value:function(){this._cssTheme={lbg:window.getComputedStyle(document.querySelector(":root")).getPropertyValue("--color-l-bg"),ltxt:window.getComputedStyle(document.querySelector(":root")).getPropertyValue("--color-l-txt"),lcom:window.getComputedStyle(document.querySelector(":root")).getPropertyValue("--color-l-txt-alt"),dbg:window.getComputedStyle(document.querySelector(":root")).getPropertyValue("--color-d-bg"),dtxt:window.getComputedStyle(document.querySelector(":root")).getPropertyValue("--color-d-txt"),dcom:window.getComputedStyle(document.querySelector(":root")).getPropertyValue("--color-d-txt-alt")},localStorage.setItem("theme",JSON.stringify(this._cssTheme))}},{key:"applyThemeColor",value:function(){document.querySelector(":root").style.setProperty("--color-l-bg",this._cssTheme.lbg),document.querySelector(":root").style.setProperty("--color-l-txt",this._cssTheme.ltxt),document.querySelector(":root").style.setProperty("--color-l-txt-alt",this._cssTheme.lcom),document.querySelector(":root").style.setProperty("--color-d-bg",this._cssTheme.dbg),document.querySelector(":root").style.setProperty("--color-d-txt",this._cssTheme.dtxt),document.querySelector(":root").style.setProperty("--color-d-txt-alt",this._cssTheme.dcom),this.updateThemeColorInternal()}}])&&r(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}()}(),window.MapPoster=n.default}();